function PlacesViewModel(){var e=this;e.placeData=placeData,e.placeList=ko.observableArray([]),e.currentArray=ko.observable(),e.flickPhotos=ko.observableArray([]),e.showFlick=ko.observable(1),e.currentExpertReview=ko.observable("Select a Place to See Reviews!"),e.expertUrl=ko.observable(),e.expertLink=ko.observable(),e.tripExpertUrl=ko.observable(),e.tripExpertLink=ko.observable(),e.yelpLogo=ko.observable(),e.tripExpertLogo=ko.observable(),e.currentYelp=ko.observableArray(),e.yelpUrl=ko.observable(),e.yelpLink=ko.observable(),e.dropDown=$("#dropDown"),e.dropActivate=$("#dropActivate"),e.dropDownList=$("#dropDownList"),e.reviewHeaders=$(".review-header"),e.photoTitle=$("#photo-title"),e.filterArray=function(o,t){currentInfoWindow.close(),o?(t=ko.computed(function(){return ko.utils.arrayFilter(t,function(e){return e.type.indexOf(o)!==-1})}),markers.forEach(function(e){e.type.indexOf(o)==-1?e.setVisible(!1):e.setVisible(!0)}),e.currentArray(t())):(e.currentArray(t.sort()),markers.forEach(function(e){e.setVisible(!0)}))},e.getCurrentMarker=function(e){return markers.filter(function(o){return o.placeID==e.id})},e.displayInfo=function(o){var t=e.getCurrentMarker(o);e.openMarker(t[0]),e.loadReviews(o)},e.currentArray(e.placeList()),placeData.places.forEach(function(o){e.placeList.push(new Place(o))}),e.loadYelp=function(o,t){e.yelpLogo("../static/img/Yelp_trademark_RGB_outline.png"),o?(o.reviews.reviews.forEach(function(o){e.currentYelp.push(o)}),e.yelpUrl(o.url),e.yelpLink("Visit Yelp for More Info on "+t)):e.currentYelp({text:"Sorry, there were no yelp reviews for this place",url:"#"})},e.openMarker=function(o){currentInfoWindow.close(),e.flickPhotos([]),e.currentYelp([]),e.currentExpertReview(""),e.expertLink(""),e.tripExpertLink("");var t=e.placeData.places.filter(function(e){return o.placeID==e.id}),r=t[0].name,n=t[0].coordinates,i={placeName:r,coords:n},a=JSON.stringify(i);o&&(null!==o.getAnimation()?o.setAnimation(null):(o.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.setAnimation(null)},700))),$.ajax({url:"/yelpReviews",type:"POST",data:a,contentType:"application/json;charset=UTF-8",dataType:"json",success:function(t){var n,i;n=t.reviews.reviews[0].text||e.placeData.places.info,i=t.photo||e.placeData.places.pic;var a="<div id='iw-body' class='flex'><div class='col-6' id='iw-text'><img src='../static/img/Yelp_trademark_RGB_outline.png' id='iw-logo' /><p>"+n+"</p></div><div class='col-6' id='iw-pic'><img src="+i+" /></div></div>";currentInfoWindow.setContent(a),currentInfoWindow.open(map,o),e.loadYelp(t,r)},error:function(o){e.currentYelp({text:"Sorry, there was a server side error when fetching Yelp reviews",url:"#"}),console.log(o)}})},e.loadVenue=function(o,t){var r="https://api.tripexpert.com/v1/venues/"+o[i].id+"?api_key="+t;$.ajax({url:r,type:"GET",cache:!1,success:function(o){e.tripExpertLogo("../static/img/basic-logo.png");var t,r,n,i,a;t=o.response.venues[0].reviews[0].extract||"No Reviews",r=o.response.venues[0].path||"No Path Provided",n=o.response.venues[0].reviews[0].source_url||"No Url Provided",i=o.response.venues[0].reviews[0].publication_name||"No Publication Provided",a=r?"https://www.tripexpert.com/"+r:"No Link for This Review",e.currentExpertReview(t),e.expertUrl(n),e.tripExpertUrl(a),e.tripExpertLink("Visit Trip Expert for More Reviews"),e.expertLink("Click Here for Full Review from "+i)},error:function(o){console.log(o),e.currentExpertReview("Sorry, something went wrong when fetching your reviews.")}})},e.loadTripExpert=function(o,t){var r=tKey,n="https://api.tripexpert.com/v1/venues?api_key="+r+"&destination_id=2&order_by=distance&latitude="+t.lat+"&longitude="+t.lng;$.ajax({url:n,type:"GET",cache:!1,success:function(t){var n=t.response.venues,a=!1;for(i=0;i<n.length;i++){o.length>=n[i].name.length?(matchTest=o.toLowerCase(),searchTest=n[i].name.toLowerCase()):(matchTest=n[i].name.toLowerCase(),searchTest=o.toLowerCase());if(matchTest.indexOf("shinjuku")!=-1&&(searchSplit=searchTest.split(" "),searchTest=searchSplit[searchSplit.length-1]),matchTest.includes(searchTest)&&"shinjuku"!=searchTest){a=!0,e.loadVenue(n,r);break}}a===!1&&(e.currentExpertReview("Sorry, there are no reviews from Trip Expert for this place yet, but please enjoy the photos!"),e.expertUrl(""),e.expertLink(""),e.tripExpertLink(""))},error:function(o){console.log(o),e.currentExpertReview("Sorry, something went wrong when searching for this venue...")}})},e.loadFlick=function(o){var t=fKey,r=$("#flickr"),n=o.coordinates.lat,i=o.coordinates.lng,a=o.tags.join(),s="https://api.flickr.com/services/rest/?method=flickr.photos.search&lat="+n+"&lon="+i+"&api_key="+t+"&per_page=8&format=json&nojsoncallback=1&sort=relevance&radius=1&tags="+a;$.ajax({url:s,type:"GET",success:function(o){if("ok"==o.stat){var t=o.photos.photo[0],r=t.farm,n=t.server,i=t.id,a=t.secret,s="https://farm"+r+".staticflickr.com/"+n+"/"+i+"_"+a+".jpg";$("#dropDown").css("background-image","url("+s+")");o.photos.photo.forEach(function(o){var t=o.farm,r=o.server,n=o.id,i=o.secret,a="https://farm"+t+".staticflickr.com/"+r+"/"+n+"_"+i+".jpg";e.flickPhotos.push({photo:a})}),e.showFlick(10)}else e.flickrDIV.text("Sorry, there was an error getting your photos :(")},error:function(e){console.log(e),r.text("Sorry, there was an error getting your photos :(")}})},e.loadReviews=function(o){e.reviewHeaders.css("display","block"),e.photoTitle.css("display","block"),e.loadTripExpert(o.name,o.coordinates),e.loadFlick(o)},e.dropActivate.hover(function(){e.dropDownList.css("display","block"),e.dropDownList.mouseleave(function(){$(this).css("display","none")}),e.dropDown.mouseleave(function(){e.dropDownList.css("display","none")})})}function googleError(){var e=$("#map-container");$("#explore-btn").css("display","none"),e.addClass("map-error"),e.text("Sorry, Google Maps Failed to load.")}var fKey="308f3dd16dc13ec9851d4e6a6cf7fbaa",fSecret="5f37e6c3c6b59f51",tKey="ec94a7b46ad42d743651578cd86ac4cb",self=this,placeCoords=[],markers=[];infoWindows=[],currentInfoWindow=null,bounds=null,window.initMap=function(){var e={lat:35.6938,lng:139.7035},o=[{featureType:"transit.line",elementType:"geometry.stroke",stylers:[{color:"#061f2b"}]},{featureType:"transit.station",stylers:[{hue:"orange"},{weight:9}]}];map=new google.maps.Map(document.getElementById("map"),{center:e,styles:o,zoom:14}),currentInfoWindow=new google.maps.InfoWindow({content:null}),bounds=new google.maps.LatLngBounds,mapHandler.buildCoords()};var mapHandler={buildCoords:function(){placeCoords.forEach(function(e){var o=new google.maps.Marker({position:e[0],placeID:e[1],type:e[2],animation:google.maps.Animation.DROP,map:map});o.addListener("click",function(){self.vm.openMarker(o)}),bounds.extend(o.position),markers.push(o)}),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(bounds)})}},placeData={places:[{id:1,type:["food"],name:"Moyan",yelpInfo:null,info:"A cool little Japanese curry restaurant! The food is awesome and the atmosphere is awesome too!",tags:["curry","drinks","delicious"],pic:"http://bento.com/rp/500/500-nshinj-moyanome.jpg",coordinates:{lat:35.696275,lng:139.690556}},{id:2,type:["food"],name:"Ichiran",yelpInfo:null,info:"Ichiran is a popular ramen chain. It's delicious, so be prepared for a bit of a line.",tags:["ramen","delicious"],pic:"https://foodsaurus.files.wordpress.com/2014/04/dsc01961.jpg?w=646",coordinates:{lat:35.691675,lng:139.702848}},{id:3,type:["sightseeing","park"],name:"Shinjuku Gyoen National Garden",info:"One of Tokyo's best parks. A great place to relax and enjoy the scenery.",tags:["park","cherry trees","garden"],pic:"http://img.timeinc.net/time/photoessays/2009/tokyo/tokyo_shinjuku.jpg",coordinates:{lat:35.686301,lng:139.710095}},{id:4,type:["shopping","station"],name:"JR Shinjuku Station",yelpInfo:null,info:"The world's busiest station and hub for travel around Tokyo.",tags:["station","shopping","train"],pic:"https://1.bp.blogspot.com/-eVWv6ar8LLI/VwJ4Zm4CrxI/AAAAAAAAoyM/IbnSs-Q2yp4-K0rLYvYwDq88mCOPeD0KQ/s1600/koshu-kaido-gate.jpg",coordinates:{lat:35.690788,lng:139.6996}},{id:5,type:["food"],name:"Menya",yelpInfo:null,info:"A great ramen shop in west Shinjuku. Like Ichiran, it's also popular, so be prepared for a line.",tags:["ramen","delicious"],pic:"http://farm8.staticflickr.com/7384/11326667626_9ee3a4f15f_z.jpg",coordinates:{lat:35.696458,lng:139.698653}},{id:6,type:["sightseeing"],name:"Tokyo Metropolitan Government Building",yelpInfo:null,info:"A great place to get a view of Tokyo for free.",tags:["view","skyscraper"],pic:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Tokyo_Metropolitan_Government_Building_2012.JPG/300px-Tokyo_Metropolitan_Government_Building_2012.JPG",coordinates:{lat:35.690645,lng:139.692358}},{id:7,type:["bar"],name:"Shinjuku Goldengai",yelpInfo:null,info:"If you like drinking and want a different experience than a typical bar, you should check this place out.",tags:["bar","drinks","food"],pic:"http://www.tokyoezine.com/wp-content/uploads/2011/03/Golden-Gai.jpg",coordinates:{lat:35.694021,lng:139.704624}},{id:8,type:["shopping","bar","sightseeing"],name:"Kabukicho",yelpInfo:null,info:"Tokyo's red light district. Tons of restaurants and interesting things to do and see.",tags:["shopping","drinks","fun"],pic:"https://meetrip.to/spotimg/kabukicho_6.jpg",coordinates:{lat:35.6949,lng:139.7029}}]},Place=function(e){this.id=e.id,this.type=e.type,this.name=e.name,this.pic=e.pic,this.tags=e.tags,this.coordinates=e.coordinates},MarkersViewModel={self:this,init:function(){placeData.places.forEach(function(e){e.coordinates&&placeCoords.push([e.coordinates,e.id,e.type])})}},vm=new PlacesViewModel;ko.applyBindings(vm),MarkersViewModel.init();var mainBanner=$("#main-banner");$(document).on("scroll",function(){$(this).scrollTop()>243?(mainBanner.css("position","absolute"),mainBanner.css("top",244)):(mainBanner.css("position","fixed"),mainBanner.css("top",0))});